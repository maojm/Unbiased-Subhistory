\section{Missing proofs from Section~\ref{sec:3level}}

\subsection{Clean Events}


\begin{proof}[Proof of Lemma~\ref{3levelw1}]
  For the $s$-th first-level group, define $W_1^{a,s}$ to be the event
  that the number of arm $a$ pulls in the $s$-th first-level group is
  between $q_a T_1- \GdT \sqrt{T_1\log(T)}$ and
  $q_a T_1 + \GdT \sqrt{T_1\log(T)}$. By Lemma~\ref{lem:t1runs}
\[
\Pr[W_1^{a,s}] \geq 1-2\exp(-2\log(T)) \geq 1-2/T^2.
\]
Let $W_1$  be the intersection of all these events (i.e.
$W_1 = \bigcap_{a,s}W_1^{a,s}$). By union bound, we have
\[
\Pr[W_1] \geq 1- \frac{4S}{T^2}.
\]
\end{proof}



\begin{proof}[Proof of Lemma~\ref{3levelw2}]
  By Chernoff bound,
\[
\Pr[W_2^{s,a,t_1,t_2}] \geq 1 - 2\exp(-4\log(T)) \geq 1- 2/T^4.
\]
By union bound, we have
\[
\Pr[W_2] \geq 1- \frac{4S}{T^2}.
\]
\end{proof}


\begin{proof}[Proof of Lemma~\ref{3levelw4}]
By Berry-Esseen Theorem and
  $\mu_a \in [1/3,2/3]$, we have for any $a$,
\[
\Pr[W_4^{s,a,high}] \geq (1-\Phi(1/2)) - \frac{5}{\sqrt{q_aT_1}} > 1/4.
\]
The last inequality follows when $T$ is larger than some constant.
Similarly we also have 
\[
\Pr[W_4^{s,a,low}] > 1/4.
\]
Since $W_4^{s,a,high}$ is independent with $W_4^{s,3-a,low}$, we have
\[
\Pr[W_4^{s,a,high} \cap W_4^{s,3-a,low}] =\Pr[W_4^{s,a,high}] \cdot  \Pr[W_4^{s,3-a,low}]>(1/4)^2 = 1/16.
\]
Notice that $(W_4^{s,a,high} \cap W_4^{s,3-a,low})$ are independent
across different $s$'s. By union bound, we have
\[
\Pr[W_4] \geq 1- 2(1-1/16)^S \geq 1 -2 /T.
\]
\end{proof}



\begin{proof}[Proof of Lemma~\ref{3levelw3}]
  For any arm $a$, let's imagine a hypothetical tape of length $T$,
  with each cell independently sampled from $\cD_a$. The tape encodes
  rewards of the first two levels as follows: the $j$-th time arm $a$
  is chosen in the first two levels, its reward is taken from the
  $j$-th cell in the tape. Define $W_3^{a,t}$ to be the event that the
  mean of the first $t$ pulls in the tape is at most
  $\sqrt{\frac{2\log(T)}{t}}$ away from $\mu_a$. By Chernoff bound,
\[
\Pr[W_3^{a,t}] \geq 1 - 2\exp(-4\log(T)) \geq 1- 2/T^4.
\]
By union bound, the intersection of all these events has probability
at least:
\[
\Pr[W_3] \geq 1- \frac{4}{T^3}.
\]
\end{proof}

\subsection{Case Analysis under Clean Events}
Now we assume the intersection of clean events $W$ happens. We will
first provide some helper lemmas for our case analysis.

\begin{lemma}
  For the $s$-th first-level group and arm $a$, define
  $\bar{\mu}_a^{1,s}$ to be the empirical mean of arm $a$ pulls in
  this group. If $W$ holds, then
  \[
    |\bar{\mu}_a^{1,s} - \mu_a| \leq \sqrt{\frac{4\log(T)}{q_a T_1}}.
  \]
\end{lemma}

\begin{proof}
  The events $W_1$ and $W_2^{a,s,1,t}$ for
  $t = q_a T_1- \GdT \sqrt{T_1\log(T)},...,q_a T_1 + \GdT
  \sqrt{T_1\log(T)}$ together imply that
\[
|\bar{\mu}_a^{1,s} - \mu_a| \leq \sqrt{\frac{2\log(T)}{q_a T_1- \GdT \sqrt{T_1\log(T)}}} \leq \sqrt{\frac{4\log(T)}{q_a T_1}}.
\]
The last inequality holds when $T$ is larger than some constant.
\end{proof}


\begin{lemma}
  For each arm $a$, define $\bar{\mu}_a$ to be the empirical mean of
  arm $a$ pulls in the first two levels. If $W$ holds, then
  \[
    |\bar{\mu}_a - \mu_a| \leq \sqrt{\frac{4\log(T)}{S q_a T_1}} .
  \]
Furthermore, if there are at least $T_2$ pulls of arm $a$ in the first
two levels,
\[
|\bar{\mu}_a-\mu_a| \leq \sqrt{\frac{2\log(T)}{T_2}}. 
\]
\end{lemma}

\begin{proof}
The events $W_1$ and $W_3^{a,t}$ for $t \geq  (q_a T_1- \GdT \sqrt{T_1\log(T)})S$ together imply that
  \[
    |\bar{\mu}_a - \mu_a| \leq \sqrt{\frac{2\log(T)}{S\left(q_a T_1- \GdT \sqrt{T_1\log(T)}\right)}} \leq \sqrt{\frac{4\log(T)}{S q_a T_1}} .
\]
The last inequality holds when $T$ is larger than some constant.
\end{proof}




\begin{proof}[Proof of Lemma~\ref{lem:luck}]
  For each $a \in \{1,2\}$, $W_4$ implies that there exists $s_a$ such
  that both $W_4^{s_a,a,high}$ and $W_4^{s_a,3-a,low}$ happen.  The
  events $W_4^{s_a,a,high}$, $W_1$, $W_2^{s_a,a,t, q_aT_1}$
  for $t = q_a T_1- \GdT \sqrt{T_1\log(T)}+1, ...,q_aT_1-1$ and
  $W_2^{s_a,a,q_aT_1,t}$ for
  $t= q_aT_1,...,q_a T_1+ \GdT \sqrt{T_1\log(T)}$ together imply that
\begin{align*}
\bar{\mu}_a ^{1,s_a} &\geq \mu_a + \left(q_aT_1 \cdot \frac{1}{\sqrt{q_aT_1}} - \GdT \sqrt{T_1\log(T)} \cdot \sqrt{\frac{2\log(T)}{ \GdT \sqrt{T_1\log(T)}}} \right) \cdot \frac{1}{q_a T_1+ \GdT \sqrt{T_1\log(T)}} \\
&> \mu_a + \frac{1}{4\sqrt{q_aT_1}}.
\end{align*}
The second to the last inequality holds when $T$ is larger than some constant.
Similarly, we also have
\[
\bar{\mu}_{3-a} ^{1,s_a} < \mu_{3-a}   - \frac{1}{4\sqrt{q_{3-a} T_1}}.
\]
This completes the proof.
\end{proof}



\begin{proof}[Proof of Lemma~\ref{3levelbigcase}]
  Observe that for any group $s$ in the first level, the empirical
  means satisfy
\[
\bar{\mu}_1^{1,s} - \bar{\mu}_2^{1,s} \geq \mu_1 -\mu_2 - \sqrt{\frac{4\log(T)}{q_1T_1}} - \sqrt{\frac{4\log(T)}{q_2T_1}} \geq  \sqrt{\frac{4\log(T)}{q_1T_1}} + \sqrt{\frac{4\log(T)}{q_2T_1}}.
\]


For any agent $t$ in the $s$-th second-level group, by Assumption \ref{ass:embehave}, we have
\begin{align*}
\hat{\mu}_1^t - \hat{\mu}_2^t &>\bar{\mu}_1^{1,s} - \bar{\mu}_2^{1,s} - \frac{c_m}{\sqrt{q_1T_1/2}} - \frac{c_m}{\sqrt{q_2T_1/2}}\\
&\geq  \sqrt{\frac{4\log(T)}{q_1T_1}} + \sqrt{\frac{4\log(T)}{q_2T_1}}- \frac{c_m}{\sqrt{q_1T_1/2}} - \frac{c_m}{\sqrt{q_2T_1/2}} > 0
\end{align*}
Therefore, we know agents in the $s$-th second-level group will all pull arm 1.

Now consider the agents in the third level group. Recall $\bar{\mu}_a$
is the empirical mean of arm $a$ in the history they see. We have
\[
\bar{\mu}_1 - \bar{\mu}_2 \geq \mu_1 -\mu_2 - \sqrt{\frac{4\log(T)}{Sq_1T_1}} - \sqrt{\frac{4\log(T)}{Sq_2T_1}} \geq  \sqrt{\frac{4\log(T)}{q_1T_1}} 
+ \sqrt{\frac{4\log(T)}{q_2T_1}}.
\]
Similarly as above, by Assumption \ref{ass:embehave}, we know
$\hat{\mu}_1^t - \hat{\mu}_2^t > 0$ for any agent $t$ in the third
level. Therefore, the agents in the third-level group will all pull
arm 1.  \OMIT{Therefore the expected regret is at most
  $S T_G T_1 = O(T^{4/7} \log^{6/7}(T))$.}
\end{proof}



\begin{proof}[Proof of Lemma~\ref{3levelmidcase}]
  We will further break down the intermediate case into two sub-cases.
\begin{itemize}

\item Sub-case (1):
  $2\left(\sqrt{\frac{4\log(T)}{Sq_1T_1}} +
    \sqrt{\frac{4\log(T)}{Sq_2T_1}}\right) \leq \mu_1-\mu_2 <
  2\left(\sqrt{\frac{4\log(T)}{q_1T_1}} +
    \sqrt{\frac{4\log(T)}{q_2T_1}}\right)$. Recall $\bar{\mu}_a$ is
  the empirical mean of arm $a$ in the first two levels. We have
\[
\bar{\mu}_1 - \bar{\mu}_2 \geq \mu_1 -\mu_2 - \sqrt{\frac{4\log(T)}{Sq_1T_1}} - \sqrt{\frac{4\log(T)}{Sq_2T_1}} \geq  \sqrt{\frac{4\log(T)}{Sq_1T_1}} 
+ \sqrt{\frac{4\log(T)}{Sq_2T_1}}.
\]
For any agent $t$ in the third level, by Assumption \ref{ass:embehave}, we have
\begin{align*}
\hat{\mu}_1^t - \hat{\mu}_2^t &>\bar{\mu}_1 - \bar{\mu}_2 - \frac{c_m}{\sqrt{Sq_1T_1/2}} - \frac{c_m}{\sqrt{Sq_2T_1/2}}\\
&\geq  \sqrt{\frac{4\log(T)}{Sq_1T_1}} + \sqrt{\frac{4\log(T)}{Sq_2T_1}}- \frac{c_m}{\sqrt{Sq_1T_1/2}} - \frac{c_m}{\sqrt{Sq_2T_1/2}}\\
 &> 0.
\end{align*}
So we know agents in the third-level group will all pull arm 1. \OMIT{Therefore the expected regret is at most 
\[
(S T_G T_1 + S T_2) \cdot 2\left(\sqrt{\frac{4\log(T)}{q_1T_1}} 
+ \sqrt{\frac{4\log(T)}{q_2T_1}}\right) = O(T^{4/7} \log^{6/7}(T))
\]
}
\item Sub-case (2):
  $ 3\sqrt{\frac{2\log(T)}{T_2}} < \mu_1-\mu_2 <
  2\left(\sqrt{\frac{4\log(T)}{Sq_1T_1}} +
    \sqrt{\frac{4\log(T)}{Sq_2T_1}}\right)$.  In this sub-case, we
  need both arms to be pulled at least $T_2$ rounds in the second
  level. For every arm $a$, consider the $s_a$-th second-level group,
  with $s_a$ given by Lemma~\ref{lem:luck}. We have
\begin{align*}
\bar{\mu}_a^{1,s_a} - \bar{\mu}_{3-a}^{1,s_a} &> \mu_a + \frac{1}{4\sqrt{q_aT_1}} -\mu_{3-a} +\frac{1}{4\sqrt{q_{3-a}T_1}} \\
&> \frac{1}{4\sqrt{q_1T_1}}+ \frac{1}{4\sqrt{q_2T_1}} - 2\left(\sqrt{\frac{4\log(T)}{Sq_1T_1}} 
+ \sqrt{\frac{4\log(T)}{Sq_2T_1}}\right) \\
&\geq \frac{1}{8\sqrt{q_1T_1}}+ \frac{1}{8\sqrt{q_2T_1}}.
\end{align*}
For any agent $t$ in the $s_a$-th second-level group, by Assumption \ref{ass:embehave}, we have
\begin{align*}
\hat{\mu}_a^t - \hat{\mu}_{3-a}^t &>\bar{\mu}_a^{1,s_a} - \bar{\mu}_{3-a}^{1,s_a} - \frac{c_m}{\sqrt{q_1T_1/2}} - \frac{c_m}{\sqrt{q_2T_1/2}}\\
&\geq   \frac{1}{8\sqrt{q_1T_1}}+ \frac{1}{8\sqrt{q_2T_1}}- \frac{c_m}{\sqrt{q_1T_1/2}} - \frac{c_m}{\sqrt{q_2T_1/2}}\\
 &> 0.
\end{align*}
So we know agents in the $s_a$-th second-level group will all pull arm $a$. Therefore in the first two levels, both arms are pulled at least $T_2$ times. Now consider the third-level. We have
\[
\bar{\mu}_1 - \bar{\mu}_2  \geq \mu_1 -\mu_2 - 2\sqrt{\frac{2\log(T)}{T_2}} \geq \sqrt{\frac{2\log(T)}{T_2}}.
\]
Similarly as above, by Assumption \ref{ass:embehave}, we know $\hat{\mu}_1^t - \hat{\mu}_2^t > 0$ for any agent $t$ in the third level. So we know agents in the third-level group will all pull arm 1.\OMIT{
Therefore the expected regret is at most 
\[
(S T_G T_1 + S T_2) \cdot 2\left(\sqrt{\frac{4\log(T)}{Sq_1T_1}} 
+ \sqrt{\frac{4\log(T)}{Sq_2T_1}}\right) \leq O(T^{4/7} \log^{6/7}(T))
\]
}
\end{itemize}
Together the two sub-cases complete the proof.
\end{proof}